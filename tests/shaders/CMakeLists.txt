# Smoke-test shader compilation ...
FILE(GLOB_RECURSE SHADER_LIST ${share_SOURCE_DIR}/shaders/*.sl)
LIST(SORT SHADER_LIST)

# Test shader compilation with aqsis ...
FIND_PROGRAM(AQSL_COMMAND aqsl)
MARK_AS_ADVANCED(AQSL_COMMAND)

IF(AQSL_COMMAND)
	FOREACH(SHADER ${SHADER_LIST})
		GET_FILENAME_COMPONENT(SHADER_NAME ${SHADER} NAME)
		GET_FILENAME_COMPONENT(SHADER_PATH ${SHADER} PATH)
		K3D_TEST(shader.compile.aqsis.${SHADER_NAME}
			COMMAND ${AQSL_COMMAND} -I "${SHADER_PATH}" -I "${share_SOURCE_DIR}/shaders" -o ${CMAKE_CURRENT_BINARY_DIR}/${SHADER_NAME}x ${SHADER}
			LABELS shader aqsis)
	ENDFOREACH()
ENDIF()

# Test shader compilation with pixie ...
FIND_PROGRAM(SDRC_COMMAND sdrc)
MARK_AS_ADVANCED(SDRC_COMMAND)

IF(SDRC_COMMAND)
	FOREACH(SHADER ${SHADER_LIST})
		GET_FILENAME_COMPONENT(SHADER_NAME ${SHADER} NAME)
		GET_FILENAME_COMPONENT(SHADER_NAME_WE ${SHADER} NAME_WE)
		GET_FILENAME_COMPONENT(SHADER_PATH ${SHADER} PATH)
		K3D_TEST(shader.compile.pixie.${SHADER_NAME}
			COMMAND ${SDRC_COMMAND} -I"${SHADER_PATH}" -I"${share_SOURCE_DIR}/shaders" -o ${CMAKE_CURRENT_BINARY_DIR}/${SHADER_NAME_WE}.sdr ${SHADER}
			LABELS shader pixie)
	ENDFOREACH()
ENDIF()

